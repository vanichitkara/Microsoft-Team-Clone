{"ast":null,"code":"import _slicedToArray from\"/Users/mac/Desktop/video_call/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{createContext,useState,useRef,useEffect}from'react';import{io}from'socket.io-client';import Peer from'simple-peer';import{jsx as _jsx}from\"react/jsx-runtime\";var SocketContext=/*#__PURE__*/createContext();var socket=io('http://localhost:5000');// const socket = io('https://microsoft-teams-video-call.herokuapp.com');\nvar ContextProvider=function ContextProvider(_ref){var children=_ref.children;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),callAccepted=_useState2[0],setCallAccepted=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),callEnded=_useState4[0],setCallEnded=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),stream=_useState6[0],setStream=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),name=_useState8[0],setName=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),call=_useState10[0],setCall=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),me=_useState12[0],setMe=_useState12[1];var myVideo=useRef();var userVideo=useRef();var connectionRef=useRef();useEffect(function(){navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(currentStream){setStream(currentStream);myVideo.current.srcObject=currentStream;});socket.on('me',function(id){return setMe(id);});socket.on('callUser',function(_ref2){var from=_ref2.from,callerName=_ref2.name,signal=_ref2.signal;setCall({isReceivingCall:true,from:from,name:callerName,signal:signal});});},[]);var answerCall=function answerCall(){setCallAccepted(true);var peer=new Peer({initiator:false,trickle:false,stream:stream});peer.on('signal',function(data){socket.emit('answerCall',{signal:data,to:call.from});});peer.on('stream',function(currentStream){userVideo.current.srcObject=currentStream;});peer.signal(call.signal);connectionRef.current=peer;};var callUser=function callUser(id){var peer=new Peer({initiator:true,trickle:false,stream:stream});peer.on('signal',function(data){socket.emit('callUser',{userToCall:id,signalData:data,from:me,name:name});});peer.on('stream',function(currentStream){userVideo.current.srcObject=currentStream;});socket.on('callAccepted',function(signal){setCallAccepted(true);peer.signal(signal);});connectionRef.current=peer;};var leaveCall=function leaveCall(){setCallEnded(true);connectionRef.current.destroy();window.close();};return/*#__PURE__*/_jsx(SocketContext.Provider,{value:{call:call,callAccepted:callAccepted,myVideo:myVideo,userVideo:userVideo,stream:stream,name:name,setName:setName,callEnded:callEnded,me:me,callUser:callUser,leaveCall:leaveCall,answerCall:answerCall},children:children});};export{ContextProvider,SocketContext};","map":{"version":3,"sources":["/Users/mac/Desktop/video_call/client/src/Context.js"],"names":["React","createContext","useState","useRef","useEffect","io","Peer","SocketContext","socket","ContextProvider","children","callAccepted","setCallAccepted","callEnded","setCallEnded","stream","setStream","name","setName","call","setCall","me","setMe","myVideo","userVideo","connectionRef","navigator","mediaDevices","getUserMedia","video","audio","then","currentStream","current","srcObject","on","id","from","callerName","signal","isReceivingCall","answerCall","peer","initiator","trickle","data","emit","to","callUser","userToCall","signalData","leaveCall","destroy","window","close"],"mappings":"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","sourcesContent":["import React, { createContext, useState, useRef, useEffect } from 'react';\nimport { io } from 'socket.io-client';\nimport Peer from 'simple-peer';\n\nconst SocketContext = createContext();\n\nconst socket = io('http://localhost:5000');\n// const socket = io('https://microsoft-teams-video-call.herokuapp.com');\n\nconst ContextProvider = ({ children }) => {\n  const [callAccepted, setCallAccepted] = useState(false);\n  const [callEnded, setCallEnded] = useState(false);\n  const [stream, setStream] = useState();\n  const [name, setName] = useState('');\n  const [call, setCall] = useState({});\n  const [me, setMe] = useState('');\n\n  const myVideo = useRef();\n  const userVideo = useRef();\n  const connectionRef = useRef();\n\n  useEffect(() => {\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true })\n      .then((currentStream) => {\n        setStream(currentStream);\n\n        myVideo.current.srcObject = currentStream;\n      });\n\n    socket.on('me', (id) => setMe(id));\n\n    socket.on('callUser', ({ from, name: callerName, signal }) => {\n      setCall({ isReceivingCall: true, from, name: callerName, signal });\n    });\n  }, []);\n\n  const answerCall = () => {\n    setCallAccepted(true);\n\n    const peer = new Peer({ initiator: false, trickle: false, stream });\n\n    peer.on('signal', (data) => {\n      socket.emit('answerCall', { signal: data, to: call.from });\n    });\n\n    peer.on('stream', (currentStream) => {\n      userVideo.current.srcObject = currentStream;\n    });\n\n    peer.signal(call.signal);\n\n    connectionRef.current = peer;\n  };\n\n  const callUser = (id) => {\n    const peer = new Peer({ initiator: true, trickle: false, stream });\n\n    peer.on('signal', (data) => {\n      socket.emit('callUser', { userToCall: id, signalData: data, from: me, name });\n    });\n\n    peer.on('stream', (currentStream) => {\n      userVideo.current.srcObject = currentStream;\n    });\n\n    socket.on('callAccepted', (signal) => {\n      setCallAccepted(true);\n\n      peer.signal(signal);\n    });\n\n    connectionRef.current = peer;\n  };\n\n  const leaveCall = () => {\n    setCallEnded(true);\n\n    connectionRef.current.destroy();\n\n    window.close();\n  };\n\n  return (\n    <SocketContext.Provider value={{\n      call,\n      callAccepted,\n      myVideo,\n      userVideo,\n      stream,\n      name,\n      setName,\n      callEnded,\n      me,\n      callUser,\n      leaveCall,\n      answerCall,\n    }}\n    >\n      {children}\n    </SocketContext.Provider>\n  );\n};\n\nexport { ContextProvider, SocketContext };\n"]},"metadata":{},"sourceType":"module"}